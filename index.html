<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Virtual Screen Detector</title>
  <style>
    :root { --bg:#0b0d10; --panel:#14181d; --muted:#9aa7b1; --text:#e6edf3; --accent:#6ea8fe; --ok:#2ecc71; --warn:#f39c12; --bad:#e74c3c; }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b0d10,#0e1116 40%,#0b0d10);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    h1{margin:6px 0 10px}
    .sub{color:var(--muted);margin-bottom:16px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .card{background:var(--panel);border:1px solid #222a33;border-radius:16px;padding:16px;box-shadow:0 10px 40px rgba(0,0,0,.35);margin-bottom:16px}
    .btn{appearance:none;border:1px solid #2a3440;background:#161b22;color:var(--text);padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;transition:.2s}
    .btn:hover{transform:translateY(-1px);border-color:#3a4656}
    .btn.primary{background:linear-gradient(180deg,#1f6feb,#1158c7);border-color:#1f6feb}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700;letter-spacing:.2px}
    .b-ok{background:rgba(46,204,113,.15);color:var(--ok);border:1px solid rgba(46,204,113,.35)}
    .b-warn{background:rgba(243,156,18,.15);color:var(--warn);border:1px solid rgba(243,156,18,.35)}
    .b-bad{background:rgba(231,76,60,.15);color:var(--bad);border:1px solid rgba(231,76,60,.35)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace; font-size:13px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;border-bottom:1px solid #232a33;vertical-align:top}
    th{color:#b7c2cc;text-align:left;font-weight:700;width:240px}
    textarea{width:100%;min-height:220px;resize:vertical;background:#0d1117;color:var(--text);border:1px solid #222a33;border-radius:12px;padding:12px}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:flex-start">
        <div>
          <h1>Virtual Screen Detector</h1>
          <div class="sub">–≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ¬´–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ/–±–µ–∑-GPU –æ–∫—Ä—É–∂–µ–Ω–∏–µ¬ª vs ¬´—Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ¬ª –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞.</div>
        </div>
        <div class="row">
          <button class="btn primary" id="runBtn">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</button>
          <button class="btn" id="copyBtn" disabled>–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON</button>
          <button class="btn" id="saveBtn" disabled>–°–∫–∞—á–∞—Ç—å JSON</button>
        </div>
      </div>
      <div class="row" style="justify-content:space-between;margin-top:8px">
        <div class="mono" id="summaryPill">–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É‚Ä¶</div>
        <span class="badge" id="badge">‚Äî</span>
      </div>
    </div>

    <div class="card">
      <h3>–ò—Ç–æ–≥–∏ –∏ –ø—Ä–∏—á–∏–Ω—ã</h3>
      <div id="hints" class="mono muted">–ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É¬ª, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª–∏.</div>
    </div>

    <div class="card">
      <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è</h3>
      <table>
        <tbody id="envT"></tbody>
      </table>
    </div>

    <div class="card">
      <h3>–ì—Ä–∞—Ñ–∏–∫–∞ (WebGL/WebGL2)</h3>
      <table>
        <tbody id="gfxT"></tbody>
      </table>
    </div>

    <div class="card">
      <h3>–ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç (JSON)</h3>
      <textarea id="jsonOut" readonly class="mono" placeholder="–ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É¬ª"></textarea>
      <div class="muted" style="margin-top:8px">
        –ü–æ–¥—Å–∫–∞–∑–∫–∞: –≤ Chrome –æ—Ç–∫—Ä–æ–π—Ç–µ <code>chrome://gpu</code> ‚Äî —Å—Ç—Ä–æ–∫–∏ ¬´Hardware accelerated¬ª –æ–∑–Ω–∞—á–∞—é—Ç, —á—Ç–æ GPU –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.
      </div>
    </div>
  </div>

<script>
const $ = s => document.querySelector(s);
const fmt = v => (v===undefined||v===null? '‚Äî' : (typeof v==='object'? JSON.stringify(v): String(v)));

function glInfo(kind="webgl"){
  try{
    const c = document.createElement("canvas");
    const gl = c.getContext(kind);
    if(!gl) return {supported:false};
    const dbg = gl.getExtension("WEBGL_debug_renderer_info");
    const vendor = dbg ? gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL) : gl.getParameter(gl.VENDOR);
    const renderer = dbg ? gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL) : gl.getParameter(gl.RENDERER);
    const maxTex = gl.getParameter(gl.MAX_TEXTURE_SIZE);
    const maxCube = gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE);
    const ext = gl.getSupportedExtensions() || [];
    return {supported:true, vendor, renderer, maxTextureSize:maxTex, maxCubeMapSize:maxCube, extensionsCount: ext.length};
  }catch(e){return {supported:false, error:String(e)}}
}

async function runDetection(){
  // Screen / Window / Navigator
  const screenInfo = {
    width: screen.width, height: screen.height,
    availWidth: screen.availWidth, availHeight: screen.availHeight,
    colorDepth: screen.colorDepth, pixelDepth: screen.pixelDepth,
    devicePixelRatio: window.devicePixelRatio,
    innerWidth, innerHeight, outerWidth, outerHeight,
    orientation: screen.orientation?.type || null,
  };
  const navInfo = {
    userAgent: navigator.userAgent,
    platform: navigator.platform,
    languages: navigator.languages,
    hardwareConcurrency: navigator.hardwareConcurrency,
    maxTouchPoints: navigator.maxTouchPoints,
    webdriver: navigator.webdriver === true
  };

  // WebGL/WebGL2
  const webgl  = glInfo("webgl");
  const webgl2 = glInfo("webgl2");

  // WebGPU (—Ç–æ–ª—å–∫–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä)
  const webgpu = { supported: 'gpu' in navigator };
  if(webgpu.supported){
    try{
      const adapter = await navigator.gpu.requestAdapter();
      if(adapter){ webgpu.adapterName = adapter.name || null; }
    }catch(e){ webgpu.error = String(e); }
  }

  // Media devices
  const mediaDevices = { supported: !!(navigator.mediaDevices?.enumerateDevices) };
  if(mediaDevices.supported){
    try{
      const list = await navigator.mediaDevices.enumerateDevices();
      mediaDevices.count = list.length;
      mediaDevices.kinds = Array.from(new Set(list.map(d=>d.kind)));
    }catch(e){ mediaDevices.error = String(e); }
  }

  // Permissions snapshot
  async function queryPerm(name){
    try{ const p = await navigator.permissions.query({name}); return p.state; }
    catch{ return 'unsupported'; }
  }
  const permissions = {
    camera: await queryPerm('camera'),
    microphone: await queryPerm('microphone'),
    geolocation: await queryPerm('geolocation'),
    notifications: await queryPerm('notifications'),
  };

  // Heuristics
  const hints = [];
  const webglSoftware =
    /(llvmpipe|software|swiftshader)/i.test((webgl.renderer||'')) ||
    /(software)/i.test((webgl.vendor||'')) ||
    /(llvmpipe|software|swiftshader)/i.test((webgl2.renderer||'')) ||
    /(software)/i.test((webgl2.vendor||''));

  if (webgl.suggested || webgl2.suggested) {} // placeholder, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

  // –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ, –Ω–æ –ù–ï ¬´–∫—Ä–∞—Å–Ω—ã–µ¬ª —Å–∞–º–∏ –ø–æ —Å–µ–±–µ
  if (/linux/i.test(navInfo.platform||'')) {
    hints.push("–ò–Ω—Ñ–æ: Linux-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –¥–ª—è DPR=1 –±–µ–∑ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.");
  }

  // –ü—Ä–∏—á–∏–Ω—ã (–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ)
  if (webglSoftware) hints.push("WebGL/WebGL2 –≤—ã–≥–ª—è–¥—è—Ç –∫–∞–∫ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä (llvmpipe/Software/SwiftShader).");
  if (mediaDevices.supported && (mediaDevices.count===0)) hints.push("enumerateDevices –≤–µ—Ä–Ω—É–ª 0 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (–∫–∞–º–µ—Ä/–º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–≤).");
  if (navInfo.webdriver) hints.push("navigator.webdriver === true (–ø—Ä–∏–∑–Ω–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏).");
  if (/headless/i.test(navInfo.userAgent||'')) hints.push("User-Agent —Å–æ–¥–µ—Ä–∂–∏—Ç 'Headless'.");

  // –ë–æ–ª–µ–µ ¬´–∂—ë—Å—Ç–∫–∞—è¬ª –ª–æ–≥–∏–∫–∞: —Å—á–∏—Ç–∞–µ–º –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º, –µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ñ—Ç-—Ä–µ–Ω–¥–µ—Ä –ò (–Ω–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ò–õ–ò webdriver/headless)
  const strongContext = (mediaDevices.count===0) || navInfo.webdriver || /headless/i.test(navInfo.userAgent||'');
  const suspicionStrong = webglSoftware && strongContext;

  // –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞
  const suspicious = suspicionStrong;

  const report = {
    screenInfo, navInfo, webgl, webgl2, webgpu, mediaDevices, permissions,
    heuristics: {
      webglSoftware,
      strongContext,
      suspicionStrong,
      suspicionScore: [webglSoftware, strongContext].filter(Boolean).length
    },
    suspectVirtual: suspicious,
    note: "–õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–∏ –æ—Ç–∫–ª—é—á—ë–Ω–Ω–æ–º –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–º —É—Å–∫–æ—Ä–µ–Ω–∏–∏, —Å—Ç–∞—Ä—ã—Ö –¥—Ä–∞–π–≤–µ—Ä–∞—Ö –∏–ª–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ —É–¥–∞–ª—ë–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏."
  };

  render(report, hints);
  return report;
}

function render(rep, hints){
  // Summary line
  const pill = $('#summaryPill');
  const badge = $('#badge');

  const txt = rep.suspectVirtual
    ? '‚ö† –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ/–±–µ–∑-GPU –æ–∫—Ä—É–∂–µ–Ω–∏—è'
    : (rep.heuristics.webglSoftware
        ? '‚Ñπ –û–±–Ω–∞—Ä—É–∂–µ–Ω –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä, –Ω–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–ª–∞–±—ã–π'
        : '‚úì –ü–æ—Ö–æ–∂–µ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ / GPU –¥–æ—Å—Ç—É–ø–µ–Ω');

  pill.textContent = `${txt} ¬∑ score=${rep.heuristics.suspicionScore}`;
  badge.className = 'badge ' + (rep.suspectVirtual ? 'b-bad' : (rep.heuristics.webglSoftware ? 'b-warn' : 'b-ok'));
  badge.textContent = rep.suspectVirtual ? '–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ' : (rep.heuristics.webglSoftware ? '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ' : '–û–∫');

  // Hints list
  $('#hints').innerHTML = hints.length
    ? `<ul>${hints.map(h=>`<li>${h}</li>`).join('')}</ul>`
    : '<span class="muted">–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</span>';

  // Environment table
  const env = {
    userAgent: rep.navInfo.userAgent,
    platform: rep.navInfo.platform,
    languages: rep.navInfo.languages,
    hardwareConcurrency: rep.navInfo.hardwareConcurrency,
    maxTouchPoints: rep.navInfo.maxTouchPoints,
    webdriver: rep.navInfo.webdriver,
    screen: `${rep.screenInfo.width}√ó${rep.screenInfo.height} @ DPR=${rep.screenInfo.devicePixelRatio}`,
    inner: `${rep.screenInfo.innerWidth}√ó${rep.screenInfo.innerHeight}`,
    outer: `${rep.screenInfo.outerWidth}√ó${rep.screenInfo.outerHeight}`,
    avail: `${rep.screenInfo.availWidth}√ó${rep.screenInfo.availHeight}`,
    orientation: rep.screenInfo.orientation
  };
  fillTable($('#envT'), env);

  // Graphics table
  const gfx = {
    webgl_supported: rep.webgl.supported,
    webgl_vendor: rep.webgl.vendor || 'n/a',
    webgl_renderer: rep.webgl.renderer || 'n/a',
    webgl_maxTexture: rep.webgl.maxTextureSize ?? 'n/a',
    webgl_extensions: rep.webgl.extensionsCount ?? 'n/a',
    webgl2_supported: rep.webgl2.supported,
    webgl2_vendor: rep.webgl2.vendor || 'n/a',
    webgl2_renderer: rep.webgl2.renderer || 'n/a',
    webgl2_maxTexture: rep.webgl2.maxTextureSize ?? 'n/a',
    webgl2_extensions: rep.webgl2.extensionsCount ?? 'n/a',
    webgpu_supported: rep.webgpu.supported,
    webgpu_adapter: rep.webgpu.adapterName || rep.webgpu.error || 'n/a',
    media_devices_supported: rep.mediaDevices.supported,
    media_devices_count: rep.mediaDevices.count ?? 'n/a',
    media_kinds: rep.mediaDevices.kinds || 'n/a'
  };
  fillTable($('#gfxT'), gfx);

  // JSON
  const json = JSON.stringify(rep, null, 2);
  $('#jsonOut').value = json;
  $('#copyBtn').disabled = false;
  $('#saveBtn').disabled = false;
}

function fillTable(tbody, obj){
  tbody.innerHTML = '';
  Object.entries(obj).forEach(([k,v])=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<th>${k}</th><td class="mono">${fmt(v)}</td>`;
    tbody.appendChild(tr);
  });
}

// Actions
$('#runBtn').addEventListener('click', async ()=>{
  $('#runBtn').disabled = true; $('#runBtn').textContent = '–ü—Ä–æ–≤–µ—Ä—è—é‚Ä¶';
  try{ await runDetection(); } finally {
    $('#runBtn').disabled = false; $('#runBtn').textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É';
  }
});
$('#copyBtn').addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText($('#jsonOut').value);
    $('#copyBtn').textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
    setTimeout(()=> $('#copyBtn').textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON', 1000);
  }catch{}
});
$('#saveBtn').addEventListener('click', ()=>{
  const blob = new Blob([$('#jsonOut').value], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'virtual_screen_report.json';
  document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=> URL.revokeObjectURL(a.href), 2000);
});
</script>


<script>
navigator.mediaDevices.enumerateDevices().then(devs => console.log("devices:", devs)).catch(e => console.error("enum error:", e));
Promise.all([
  navigator.permissions.query({name:'camera'}).catch(()=>null),
  navigator.permissions.query({name:'microphone'}).catch(()=>null),
]).then(p => console.log("permissions:", p));
</script>


<script>
// reality-check.js
(async () => {
  const out = {
    when: new Date().toISOString(),
    ua: navigator.userAgent,
    platform: navigator.platform,
    languages: navigator.languages,
    timezoneOffset: new Date().getTimezoneOffset(),
    locale: Intl.DateTimeFormat().resolvedOptions().locale,
    hw: {
      dpr: window.devicePixelRatio || 0,
      screen: { w: screen.width, h: screen.height, aw: screen.availWidth, ah: screen.availHeight, colorDepth: screen.colorDepth },
      cores: navigator.hardwareConcurrency ?? null,
      deviceMemory: navigator.deviceMemory ?? null,
      touchPoints: navigator.maxTouchPoints ?? 0
    },
    nav: {
      plugins: (navigator.plugins && Array.from(navigator.plugins).map(p => p.name)) || [],
      mimeTypes: (navigator.mimeTypes && Array.from(navigator.mimeTypes).map(m => m.type)) || [],
      webdriver: navigator.webdriver === true
    },
    permissions: {},
    webrtc: { candidates: [], hasRTCPeerConnection: !!window.RTCPeerConnection },
    mediaDevices: { kinds: {}, total: 0 },
    webgl: {},
    canvasHash: null,
    fontsProbe: {}
  };

  // ----- Canvas fingerprint (–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –ø–æ—ç—Ç–æ–º—É –Ω–µ tainted)
  try {
    const c = document.createElement('canvas');
    c.width = 280; c.height = 80;
    const ctx = c.getContext('2d');
    ctx.textBaseline = 'top';
    ctx.font = "14px 'Arial'";
    ctx.fillStyle = '#f60';
    ctx.fillRect(125,1,62,20);
    ctx.fillStyle = '#069';
    ctx.fillText('RealityCheck-' + (navigator.hardwareConcurrency||'x'), 2, 2);
    ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
    ctx.fillText('ùïãùïñùï§ùï•', 4, 18);
    const dataUrl = c.toDataURL('image/png');
    // –±—ã—Å—Ç—Ä—ã–π poor-man hash
    let hash = 0;
    for (let i = 0; i < dataUrl.length; i++) {
      hash = ((hash<<5) - hash) + dataUrl.charCodeAt(i);
      hash |= 0;
    }
    out.canvasHash = hash >>> 0; // uint
  } catch (e) { out.canvasHash = null; }

  // ----- WebGL (–≤ —Ç.—á. UNMASKED_VENDOR/RENDERER)
  function getParamSafe(gl, pname) { try { return gl.getParameter(pname); } catch { return null; } }
  (function webgl() {
    const canvas = document.createElement('canvas');
    let gl = canvas.getContext('webgl2') || canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
    if (!gl) { out.webgl = { supported:false }; return; }
    const dbg = gl.getExtension('WEBGL_debug_renderer_info');
    out.webgl = {
      supported: true,
      version: gl instanceof WebGL2RenderingContext ? 'webgl2' : 'webgl1',
      vendor: String(getParamSafe(gl, gl.VENDOR)),
      renderer: String(getParamSafe(gl, gl.RENDERER)),
      shading: String(getParamSafe(gl, gl.SHADING_LANGUAGE_VERSION)),
      maxTextureSize: Number(getParamSafe(gl, gl.MAX_TEXTURE_SIZE)),
      unmaskedVendor: dbg ? String(getParamSafe(gl, dbg.UNMASKED_VENDOR_WEBGL)) : null,
      unmaskedRenderer: dbg ? String(getParamSafe(gl, dbg.UNMASKED_RENDERER_WEBGL)) : null
    };
  })();

  // ----- enumerateDevices (–≤–∫–ª—é—á–∞—è audiooutput)
  try {
    if (navigator.mediaDevices?.enumerateDevices) {
      const list = await navigator.mediaDevices.enumerateDevices();
      out.mediaDevices.total = list.length;
      const kinds = {};
      for (const d of list) kinds[d.kind] = (kinds[d.kind] || 0) + 1;
      out.mediaDevices.kinds = kinds; // e.g. {audioinput:1, audiooutput:1, videoinput:1}
    }
  } catch (e) {}

  // ----- Permissions (camera/microphone/notifications)
  async function perm(name) {
    try {
      if (!navigator.permissions?.query) return 'unknown';
      const s = await navigator.permissions.query({ name });
      return s.state; // 'prompt'|'granted'|'denied'
    } catch { return 'unknown'; }
  }
  out.permissions.camera = await perm('camera');
  out.permissions.microphone = await perm('microphone');
  out.permissions.notifications = await perm('notifications');

  // ----- WebRTC ICE candidates (–≤—ã–¥–∞—ë—Ç —Ç–∏–ø—ã: host/srflx/relay)
  try {
    if ('RTCPeerConnection' in window) {
      const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });
      pc.createDataChannel('x');
      pc.onicecandidate = ev => {
        if (ev.candidate && ev.candidate.candidate) {
          const c = ev.candidate.candidate;
          const m = c.match(/ typ (\w+) /);
          if (m) out.webrtc.candidates.push(m[1]); // host, srflx, relay
        }
      };
      const off = await pc.createOffer({ offerToReceiveAudio: false, offerToReceiveVideo: false });
      await pc.setLocalDescription(off);
      await new Promise(r => setTimeout(r, 800));
      pc.close();
    }
  } catch (e) {}

  // ----- CSS font probe (–æ—á–µ–Ω—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ)
  (function fontProbe() {
    const test = (font) => {
      const s = document.createElement('span');
      s.style.cssText = 'position:absolute;left:-9999px;font-size:72px;';
      s.innerHTML = 'mmmmmmmmmmlli';
      document.body.appendChild(s);
      s.style.fontFamily = font + ', monospace';
      const w = s.getBoundingClientRect().width;
      s.remove();
      return Math.round(w);
    };
    out.fontsProbe.sample = {
      Arial: test('Arial'),
      'Times New Roman': test('Times New Roman'),
      'Courier New': test('Courier New')
    };
  })();

  // ----- –ü—Ä–æ—Å—Ç–µ–π—à–∏–π ¬´—Å–∫–æ—Ä —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏¬ª
  function scoreReality(o) {
    let score = 0, reasons = [];

    // WebGL renderer
    const r = (o.webgl.unmaskedRenderer || o.webgl.renderer || '').toLowerCase();
    const v = (o.webgl.unmaskedVendor || o.webgl.vendor || '').toLowerCase();
    const BAD = ['llvmpipe','software','swiftshader','microsoft basic render','virtualbox','vmware','parallels'];
    if (BAD.some(k => r.includes(k) || v.includes(k))) { reasons.push('software/virtual GPU'); }
    else score += 25;

    // DPR & screen
    if (o.hw.dpr >= 1 && o.hw.dpr <= 4 && o.hw.screen.w >= 1024 && o.hw.screen.h >= 768) score += 10;
    else reasons.push('odd DPR/screen');

    // Hardware threads & memory
    if ((o.hw.cores ?? 0) >= 2) score += 10; else reasons.push('low cores');
    if ((o.hw.deviceMemory ?? 2) >= 2) score += 5;

    // Plugins & mimeTypes (–≤ —Ä–µ–∞–ª—å–Ω—ã—Ö Chrome/Firefox –æ–±—ã—á–Ω–æ –Ω–µ –ø—É—Å—Ç–æ)
    if (o.nav.plugins.length + o.nav.mimeTypes.length > 0) score += 10;
    else reasons.push('no plugins/mimeTypes');

    // enumerateDevices
    const md = o.mediaDevices.kinds;
    if ((md.audioinput||0) + (md.videoinput||0) + (md.audiooutput||0) >= 1) score += 15;
    else reasons.push('no media devices');

    // WebRTC
    if (o.webrtc.candidates.length > 0) score += 5;

    // Canvas hash present
    if (o.canvasHash !== null) score += 10; else reasons.push('canvas blocked');

    // Permissions states
    if (['granted','prompt'].includes(o.permissions.camera) || ['granted','prompt'].includes(o.permissions.microphone)) score += 10;

    // webdriver flag
    if (o.nav.webdriver) reasons.push('navigator.webdriver=true'); else score += 10;

    return { score: Math.min(score, 100), reasons };
  }

  const verdict = scoreReality(out);

  console.log('=== Reality Check ===');
  console.table({
    'UA': out.ua,
    'Platform': out.platform,
    'DPR': out.hw.dpr,
    'Screen': `${out.hw.screen.w}x${out.hw.screen.h} (${out.hw.screen.colorDepth}bit)`,
    'Cores': out.hw.cores,
    'DeviceMemory(GB)': out.hw.deviceMemory,
    'Plugins': out.nav.plugins.length,
    'MimeTypes': out.nav.mimeTypes.length,
    'MediaDevices': JSON.stringify(out.mediaDevices.kinds),
    'WebGL Vendor': out.webgl.unmaskedVendor || out.webgl.vendor,
    'WebGL Renderer': out.webgl.unmaskedRenderer || out.webgl.renderer,
    'MaxTexture': out.webgl.maxTextureSize,
    'WebRTC types': out.webrtc.candidates.join(',') || 'none',
    'CanvasHash': out.canvasHash,
    'webdriver': out.nav.webdriver
  });
  console.log('Permissions:', out.permissions);
  console.log('Fonts probe (widths):', out.fontsProbe.sample);
  console.log('Reality score (0..100):', verdict.score, '‚Äî issues:', verdict.reasons);
  return { details: out, verdict };
})();

</script>
</body>
</html>
